https://www.zhihu.com/question/421237964/answer/1795200233  

## 如何理解高并发
**常见的高并发场景有**：淘宝的双11、春运时的抢票、微博大V的热点新闻等。
除了这些典型事情，每秒几十万请求的秒杀系统、每天千万级的订单系统、每天亿级日活的信息流系统等，都可以归为高并发。  

## 高并发系统设计的目标
**高性能、高可用、高可扩展。**  

### 性能指标
通常，设定性能目标时会兼顾**吞吐量**和**响应时间**，比如这样表述：在每秒1万次请求下，**AVG**控制在50ms以下，**TP99**控制在100ms以下。对于高并发系统，AVG和TP分位值必须同时要考虑。  

另外，从用户体验角度来看，**200毫秒**被认为是第一个分界点，用户感觉不到延迟，**1秒是**第二个分界点，用户能感受到延迟，但是可以接受。  

因此，对于一个健康的高并发系统，TP99应该控制在200毫秒以内，TP999或者TP9999应该控制在1秒以内。  

### 可扩展性指标
对于业务集群或者基础组件来说，扩展性 = 性能提升比例 / 机器增加比例，理想的扩展能力是：资源增加几倍，性能提升几倍。通常来说，扩展能力要维持在70%以上。  

高扩展性需要考虑：服务集群、数据库、缓存和消息队列等中间件、负载均衡、带宽、依赖的第三方等，当并发达到某一个量级后，上述每个因素都可能成为扩展的瓶颈点。

## 高并发的实践方案
### 通用设计方法
* 纵向扩展（scale-up）  
它的目标是提升单机的处理能力，包括：1、提升单机的硬件性能：通过增加内存、CPU核数、存储容量、或者将磁盘升级成SSD等硬件的方式来提升。2、提升单机的软件性能：使用缓存减少I/O次数，使用并发或者异步的方式增加吞吐量。  
* 横向扩展（scale-out）  
通过集群部署以进一步提高并发处理能力，包括: 1、做好分层架构; 2、各层进行水平扩展。

### 具体实践方案
* 高性能  
1、**集群部署**，通过负载均衡减轻单机压力。  
2、**多级缓存**，包括静态数据使用CDN、本地缓存、分布式缓存等，以及对缓存场景中的热点key、缓存穿透、缓存并发、数据一致性等问题的处理。  
3、**分库分表和索引优化**，以及借助搜索引擎解决复杂查询问题。  
4、考虑**NoSQL**数据库的使用，比如HBase、TiDB等，但是团队必须熟悉这些组件，且有较强的运维能力。  
5、**异步化**，将次要流程通过多线程、MQ、甚至延时任务进行异步处理。  
6、**限流**，需要先考虑业务是否允许限流（比如秒杀场景是允许的），包括前端限流、Nginx接入层的限流、服务端的限流。  
7、对流量进行**削峰填谷**，通过 MQ承接流量。  
8、并发处理，通过多线程将串行逻辑**并行化**。  
9、**预计算**，比如抢红包场景，可以提前计算好红包金额缓存起来，发红包时直接使用即可。  
10、**减少IO次数**，比如数据库和缓存的批量读写、RPC的批量接口支持、或者通过冗余数据的方式干掉RPC调用。  
11、**减少IO时的数据包大小**，包括采用轻量级的通信协议、合适的数据结构、去掉接口中的多余字段、减少缓存key的大小、压缩缓存value等。  
13、**程序逻辑优化**，比如将大概率阻断执行流程的判断逻辑前置、For循环的计算逻辑优化，或者采用更高效的算法。  
14、各种**池化技术**的使用和池大小的设置，包括HTTP请求池、线程池（考虑CPU密集型还是IO密集型设置核心参数）、数据库和Redis连接池等。  
15、**JVM优化**，包括新生代和老年代的大小、GC算法的选择等，尽可能减少GC频率和耗时。  
16、**锁选择**，读多写少的场景用乐观锁，或者考虑通过分段锁的方式减少锁冲突。  

上述方案无外乎从计算和 IO 两个维度考虑所有可能的优化点，需要有配套的监控系统实时了解当前的性能表现，并支撑你进行性能瓶颈分析，然后再遵循二八原则，抓主要矛盾进行优化。  
